<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Data to Colors</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://fonts.googleapis.com/css?family=Roboto+Mono:300,400' rel='stylesheet' type='text/css'>
<style>
/*
html, body {
  width: 1000px;
}
*/

body {
  margin: 0;
  padding: 0;
  font-family: "Roboto Mono", sans-serif;
  background-color: #ECEFF1;
  min-width: 322px;
-webkit-tap-highlight-color: rgba(0,0,0,0);
  -webkit-tap-highlight-color: transparent;
}

div {
  position: relative;
  box-sizing: border-box;
}

h1, h2, h3, p {
  margin: 0;
  font-weight: inherit;
}

input {
  border: none;
  font-family: inherit;
  font-size: inherit;
  background-color: inherit;
  color: black;
  max-width: 100%;
}

/*
::-webkit-input-placeholder {
   color: black;
}

:-moz-placeholder {
   color: black;  
}

::-moz-placeholder {
   color: black;  
}

:-ms-input-placeholder {  
   color: black;  
}
*/

.arrow {
  display: inline-block;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAS1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmYDp0AAAAGHRSTlMAAQMFChQ1Njc4Xl9hjre5vL7A097g8/uT0s2LAAAATklEQVQY063LSQqAMBQE0U6c4xyj9v1P6lZ+WhCxlg8K+NKx+BwDlQ5chfZSw4NGD2Cc7s1kBNxGU3J2r7mX1hqmzFph3UvDKQxVgV+6AKAEBUHjmDNwAAAAAElFTkSuQmCC");
  background-size: 13px 13px;
  background-position: center;
  background-repeat: no-repeat;
  height: 13px;
  width: 13px;
  padding: 5px;
  padding-left: 17px;
  cursor: pointer;
  background-color: rgba(0,0,0,0.1);
  vertical-align: middle;
}

.center {
  margin: auto;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

.canvases {
  display: none !important;
}

.header {
  height: 100px;
  background-color: #37474F;
  text-align: center;
}

.title-text h1 {
  display: inline-block;
  margin: 0 auto;
  width: 300px;
  line-height: 100px;
  color: white;
}

.settings-block {
  position: absolute;
  height: 100px;
  width: 100px;
  right: 0;
  top: 0;
  cursor: pointer;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
}

.settings-icon {
  height: 26px;
  width: 26px;
  top: 39.5px;
  left: 39.5px;
  z-index: 9999;
  background-color: green;
  background: url("");
  background-size: 100%;
}

.settings-icon img {
  height: 26px;
  width: 26px;
  transition: transform 300ms;
}

.gear-rotate {
  transform: rotateZ(-90deg);
}

.settings {
  //visibility: hidden;
  position: absolute;
  display: block;
  height: 300px;
  width: 400px;
  max-width: calc(100% - 20px);
  right: 10px;
  margin-top: -10px;
  background-color: #ECEFF1;
  box-shadow: 0px 0px 10px rgba(0,0,0,0.3);
  z-index: 999;
  
  text-align: left;
  overflow: hidden;
  transition: 300ms;
  //-webkit-transform: translate3d(0,0,0);
}
.settings-inside * {
  transition: opacity 150ms;
}

.settings-inside h1, .settings-inside h2 {
  margin-bottom: 10px;
  line-height: 35px;
}
.settings-inside {
  line-height: 25px;
  padding: 20px;
}

.settings-inside #shapeLength {
  min-width: 70px;
  width: 70px;
}

.settings-footer {
  position: relative;
  display: block;
  color: #999;
}

.settings-footer a {
  text-decoration: none;
  color: inherit;
  cursor: pointer;
}

.settings-triangle {
  display: block;
  position: relative;
  height: 0;
  width: 0;
  margin-top: 55px;
  margin-left: 42.5px;
  /*fix for smaller width*/
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 10px solid #ECEFF1;
  transition: margin-top 200ms, border-bottom 200ms, ease-out 300ms;
  z-index: 1000;
}

.triangle-hidden {
  margin-top: 65px;
  border-bottom: 0px solid #ECEFF1;
  opacity: 0;
}

.settings-hidden {
  height: 0;
}

.settings-hidden * {
  opacity: 0;
}

.container {
  max-width: 1500px;
  margin: 0 auto;
}

.intro-animation:hover {
  animation: colors 500ms infinite;
}

.side {
  float: left;
  max-height: 1000px;
}

.code {
  height: auto;
  width: 400px;
}

.output {
  width: calc(100% - 400px);
}

.section {
  max-width: 1000px;
  padding: 20px;
  margin: 0 auto;
  line-height: 40px;
}

.top {
  color: white;
  height: 75px;
  background-color: #37474F;
  line-height: 75px;
  text-align: center;
}

.block {
  margin-top: 20px;
  margin-bottom: 20px;
  padding: 15px;
  background-color: #B0BEC5;
}

.block h2 {
  font-size: 20px;
}

.block h2 a {
  font-size: 13px;
}

textarea {
  margin: 0;
  padding: 0;
  background-color: #ECEFF1;
  border: 0;
  width: 100%;
  max-width: 100%;
  min-height: 100px;
}

.outputBlock {
  background-color: #37474F;
  min-height: 800px;
  height: calc(100vh - 140px);
  max-height: 1000px !important;
  margin-left: -20px;
  padding: 20px;
  color: white;
  font-weight: 300;
  text-align: center;
}

.outputBlock .title {
  margin-top: 15px;
  margin-bottom: 15px;
}

.hidden {
  display: none !important;
}

.img-container {
  position: relative;
  height: 40vh;
  width: 100%;
  background-color: black;
  width: 100%;
}

.img-container img {
  display: block;
  max-height: 100%;
  max-width: 100%;
  position: absolute;  
  top: 0;
  left: 0;  
  right: 0;
  bottom: 0;  
  margin: auto;  
}

.iframe-container {
  height: auto;
  min-height: 500px;
  max-height: 70vh;
  width: 100%;
  background-color: white;
  z-index: 0;
}

.iframe-container iframe {
  border: 0;
}

.group {
  display: -webkit-box;
  display: -moz-box;
  display: -ms-flexbox;
  display: -webkit-flex;
  display: flex;
  -ms-flex-direction: row;
  justify-content: center;
  flex-flow: row wrap;
  -ms-flex-pack: center;
}

.attribute {
  text-align: center;
  display: inline-block;
  background-color: #455A64;
  margin: 5px;
  padding: 10px;
}

.outputBlock a {
  text-decoration: none;
  color: inherit;
  cursor: pointer;
}

.imgur-container {
  line-height: 25px;
  text-align: center;
}

.imgur-url {
  background-color: #455A64;
  text-align: center;
  color: white;
  padding: 5px;
  overflow: hidden;
}

.container .error-container {
  position: fixed;
  width: 100%;
  max-width: 1500px;
  bottom: 0;
  text-align: center;
}

.error-container .error {
  position: absolute;
  display: block;
  height: auto;
  width: 500px;
  padding: 15px;
  color: white;
  margin: auto;
  background-color: #F44336;
  line-height: 27px;
  word-wrap: break-word;
  overflow: hidden;
  vertical-align: middle;
  bottom: 10px;
  margin-left: calc(50% - 250px);
}

#error-close {
  position: absolute;
  right: 0;
  top: 0;
  height: 57px;
  width: 57px;
  cursor: pointer;
  transition: 100ms background-color;
}
#error-close:hover {
  background-color: rgba(0,0,0,0.1);
}

#error-text {
  max-width: 330px;
  text-align: left;
}

.error-cross {
  position: absolute;
  display: block;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMBAMAAACkW0HUAAAAGFBMVEUAAAD///////////////////////////8jfp1fAAAAB3RSTlMAUIOFhoiJ960gEQAAAEJJREFUCB0FwbENgEAMBMFFFsRkn1KCM5dAKcSvC7Z9ZjgarpsV+DZjn4Yyrw2jAUobKG1gNFBmbMYuwwrM5nig7h+btg/A2Q4ZhQAAAABJRU5ErkJggg==");
  height: 12px;
  width: 12px;
  background-size: 12px 12px;
  background-position: center;
  background-repeat: no-repeat;
  vertical-align: middle;
}

#loading {
  display: inline-block;
  margin: 10px;
  height: 40px;
  width: 40px;
  border-top: 5px solid white;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 5px solid transparent;
  border-radius: 50%;
  animation: rotate 700ms linear infinite;
  text-align: center;
}

@keyframes rotate {
  0% {
    transform: rotateZ(0deg);
  }
  100% {
    transform: rotateZ(360deg);
  }
}

@-webkit-keyframes colors {
  0% {
    color: #F44336;
  }
  14.3% {
    color: #FF9800;
  }
  28.6% {
    color: #FFEB3B;
  }
  42.9% {
    color: #4CAF50;
  }
  57.1% {
    color: #2196F3;
  }
  71.4% {
    color: #E040FB;
  }
  85.6% {
    color: #E91E63;
  }
  100% {
    color: #F44336;
  }
}

@media screen and (max-width: 800px), screen and (max-device-width: 800px){
  input {
    max-width: calc(100% - 50px);
  }
  .side {
    width: 100%;
  }
  .outputBlock {
    margin-top: -20px;
    margin-left: 0;
  }
  .header {
    height: 75px;
    text-align: left;
  }
  .header .title-text h1 {
    margin-left: 20px;
    line-height: 75px;
    font-size: 25px;
  }
  .settings-icon {
    top: 25px;
  }
  .settings-triangle {
    margin-top: 32px;
  }
  .triangle-hidden {
    margin-top: 42px;
  }
  .error-container .error {
    bottom: 0 !important;
    margin-left: 0 !important;
    width: 100%;
  }
  #error-text {
    max-width: calc(100% - 42px);
  }
}

@media screen and (min-width: 1000px){
  .code {
  width: 500px;
  }

  .output {
  width: calc(100% - 500px);
  }
}

@media screen and (max-height: 825px) and (min-width: 825px) and (min-device-width: 825px){
  textarea {
    min-height: 50px;
  }
  .side {
    height: calc(100vh - 100px);
    overflow-y: auto;
  }
  .outputBlock {
    height: 660px;
  }
  .code {
    line-height: 30px;
  }
}
</style>
</head>
<body>
  <div class="canvases">
    <canvas id="encodeCanvas"></canvas>
    <canvas id="decodeCanvas"></canvas>
  </div>
  <div class="header">
    <div class="title-text">
      <h1>Data to <a class="intro-animation">Colors</a></h1>
    </div>
    <div class="settings-block" id="settings-toggle">
      <div class="settings-icon">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAABa1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+JdpW7AAAAeHRSTlMAAQIDBAUGBwgJCgsMDQ4PEBETFBUWFxgZGhwfICEiIyQlJicqMTI0Njg5Ojs9Q0ZJS0xNTlFUWFxdYmRmaGttb3N3fH5/gIOFiYuMj5KYnaCiq62wsrS5urzAwcXHyMzOz9HT1dfa3N7g4uTm6Onr7/Hz9ff5+/03OF5LAAAB7klEQVQYGY3BCVsSURgG0HcuixoWLuRo4VLYhm3SbouVZVFZViQYrqEtthkqvj8/ZJy5cz99nHsODuGU6akqWMrS1wdLBfouwNJz+u7hSLG7OXjK9M3Ak7sfw0Gda+QjtNTpq2GPM0kuJCB1/2FTKQkgSS0GoL3Mpi9tMHX9ZcvPga6pbWqbDzpzm2xZa0NY6jejrSagxddpo+wgMEE7FxHI0kojDe02bVxB2BtGewaDqjHKZwemHkY5BiHDsEphxB0pVBjWC+E1tVoWnuwatZcwdTQYKMXhi88xsBPDvtjg1ScfN6nVYtDi6wxsV6bGzx4HsEjhNMIGKXwAKFRgmqcAUCjAdJMCQGEYpjMUAAp9MLkUAApDMA1TAChcg+k6BYBCCaZPFIB5Ci7CBiisAE7m3J3i4i4DCwqaWqLWqL64NZrAvvguA+8UfOo9A40TMM1Qq/bC07tArQihn2GzY27aHZtlWAZCO6N0weTMMcqyguExo71C2HnaGIeW2qKVUwjkaechAmqZNjaS0Dp+MNq/boR1brBlJz8ws0utMX1ytM6WLRem1Hc2raQBtFHrAJBaYlO9H1L7KllU2POVvjr2qCL5qwcHxafy8LylrwLP5adJHGmCvmlYukTfDVjqp28IltQ3emoK1pQHh/oPtdh3lz9g18sAAAAASUVORK5CYII=" class="gear-rotate" id="settings-gear"/>
      </div>
      <div class="settings-triangle triangle-hidden" id="settings-triangle"></div>
    </div>
    <div class="settings settings-hidden" id="settings">
      <div class="settings-inside">
      <h1>Settings</h1>
      <h2>Default encode shape</h2>
      <form>
        <p><input type="radio" name="shape" id="shapeSquare"/>&nbsp;Square</p>
        <p><input type="radio" name="shape" id="shapeHeight"/>&nbsp;Height</p>
        <p><input type="radio" name="shape" id="shapeWidth"/>&nbsp;Width</p>
        <p id="lengthDisplay"><input type="number" id="shapeLength"/>px</p>
      </form>
        <div class="settings-footer">v0.3 Â· <a href="http://inclushe.github.io">made by Inclushe</a></div>
      </div>
    </div>
  </div>
  <div class="container" id="container">
  <div class="side code">
    <div class="section">
      <div class="top">
        <h1>Encode</h1>
      </div>
      <div class="block">
      <h2>File <a>(recommended < 1MB)</a></h2>
        <h3><input type="file" id="encodefileInput"/><a id="encodeFile" class="arrow"></a></h3>
        <h3><input type="url" id="encodeURLInput" placeholder="Image URL"/> <a id="encodeURL" class="arrow"></a></h3>
      <h3>Plain Text <a id="encodeText" class="arrow"></a></h3>
        <textarea id="encodeTextInput"></textarea>
      </div>
      <div class="top">
        <h1>Decode</h1>
      </div>
       <div class="block">
         <h2>File <a>(.png only)</a></h2>
         <h3><input type="file" id="decodeFileInput"/></h3>
      <h3><input type="url" placeholder="Image URL" id="decodeURLInput"/> <a id="decodeURL" class="arrow"></a></h3>
      </div>
    </div>
  </div>
  <div class="side output" id="outputSection">
    <div class="section">
      <div class="outputBlock" id="introBlock">
        Encode and decode files on the side.
        
      </div>
      <div class="outputBlock hidden" id="encodeBlock">
        <h2 class="title">Encoded Data</h2>
        <div class="img-container" id="encodedImgContainer"></div>
        <div class="group">
          <div class="attribute">
            <p>Height</p>
            <p id="encodedImgHeight"></p>
          </div>
          <div class="attribute">
            <p>Width</p>
            <p id="encodedImgWidth"></p>
          </div>
        </div>
        <h2><a id="encodeDL" download>Download</a></h2>
        <h2><a id="encodeImgur">Upload to Imgur</a></h2>
        <div id="loading" class="hidden"></div>
        <div class="imgur-container hidden" id="imgurContainer">
          <p>Image URL</p>
          <div class="imgur-url" id="imgurURL"></div>
          <p>Direct Decode Link</p>
          <div class="imgur-url" id="directDecodeURL"></div>
        </div>
      </div>
      <div class="outputBlock hidden" id="decodeBlock">
        <h2 class="title">Decoded Data</h2>
        <div class="img-container hidden" id="decodedImgContainer"></div>
        <div class="iframe-container" id="iframeContainer"></div>
        <div class="group">
          <div id="decodedInfo">
          <div class="attribute">
            <p>Height</p>
            <p id="decodedImgHeight"></p>
          </div>
          <div class="attribute">
            <p>Width</p>
            <p id="decodedImgWidth"></p>
          </div>
          </div>
          <div class="attribute">
            <p>File Type</p>
            <p id="decodedFileType"></p>
          </div>
        </div>
        
        <h2 class="title"><a id="decodeDL" download>Download</a></h2>
      </div>
    </div>
  </div>
  <div class="error-container hidden" id="errorContainer">
    <div style="height: 100%; width: 100%; ">
    <div class="error">
      <div id="error-close">
        <i class="error-cross center"></i>
      </div>
      <div id="error-text">An error occured.
      </div>
      
    </div>
    </div>
  </div>
</div>
<script>
var id = function(name) {
    return document.getElementById(name);
};
var ec = id("encodeCanvas");
var ectx = ec.getContext("2d");
var dc = id("decodeCanvas");
var dctx = dc.getContext("2d");
var inputString, encodingImage, decodeString, decodingImage;

// test variables
//id("encodeTextInput").value = "data:text/html;charset=utf-8,<!doctype html><html lang='en'><head><meta charset='utf-8'><title>HTML5 Test Page</title></head><body><h3>Wrapped in a <code>&lt;figure&gt;</code> element, no <code>&lt;figcaption&gt;</code></h3>  </body></html>";


//image shape settings

window.onload = function() {
    try {
        if (typeof(Storage) !== "undefined") {
            if (!localStorage.getItem("shape")) {
                localStorage.setItem("shape", "square");
            } else {
                if (localStorage.getItem("shape") === "square") {
                    id("shapeSquare").checked = true;
                    id("lengthDisplay").style.visibility = "hidden";
                }
                if (localStorage.getItem("shape") === "height") {
                    id("shapeHeight").checked = true;
                    id("lengthDisplay").style.visibility = "initial";
                }
                if (localStorage.getItem("shape") === "width") {
                    id("shapeWidth").checked = true;
                    id("lengthDisplay").style.visibility = "initial";
                }
            }
            if (!localStorage.getItem("length")) {
                localStorage.setItem("length", 400);
                id("shapeLength").value = localStorage.getItem("length");
            } else {
                if (localStorage.getItem("length").match(/[\D]/g)) {
                    localStorage.setItem("length", 400);
                }
                id("shapeLength").value = localStorage.getItem("length");
            }
        } else {
            console.log("Your browser does not support local storage.");
        }
    } catch (e) {

    }
};

id("shapeSquare").addEventListener("click", function() {
    if (this.checked === true) {
        localStorage.setItem("shape", "square");
        id("lengthDisplay").style.visibility = "hidden";
    }
}, false);
id("shapeHeight").addEventListener("click", function() {
    if (this.checked === true) {
        localStorage.setItem("shape", "height");
        id("lengthDisplay").style.visibility = "initial";
    }
}, false);
id("shapeWidth").addEventListener("click", function() {
    if (this.checked === true) {
        localStorage.setItem("shape", "width");
        id("lengthDisplay").style.visibility = "initial";
    }
}, false);
id("shapeLength").addEventListener("keyup", function() {
    //console.log(this.value);
    this.style.backgroundColor = "";
    if (this.value === "") {
        this.placeholder = 400;
        localStorage.setItem("length", 400);
    }
    if (this.value.match(/[\D]/g)) {
        this.style.backgroundColor = "rgba(255,0,0,0.3)";
    } else {
        localStorage.setItem("length", this.value);
    }
}, false);
id("shapeLength").addEventListener("change", function() {
    //console.log(this.value);
    this.style.backgroundColor = "";
    if (this.value === "") {
        this.placeholder = 400;
        localStorage.setItem("length", 400);
    }
    if (this.value.match(/[\D]/g)) {
        this.style.backgroundColor = "rgba(255,0,0,0.3)";
    } else {
        localStorage.setItem("length", this.value);
    }
}, false);

//setings toggle

var settings = id("settings");
var settingsToggle = id("settings-toggle");
var settingsTriangle = id("settings-triangle");
var settingsGear = id("settings-gear");
settingsToggle.addEventListener("click", function() {
    if (settings.className === "settings settings-hidden") {
        settings.className = "settings";
        settingsTriangle.className = "settings-triangle";
        settingsGear.className = "";
    } else {
        settings.className = "settings settings-hidden";
        settingsTriangle.className = "settings-triangle triangle-hidden";
        settingsGear.className = "gear-rotate";
    }
}, false);

id("container").addEventListener("click", function() {
    if (settings.className === "settings") {
        settings.className = "settings settings-hidden";
        settingsTriangle.className = "settings-triangle triangle-hidden";
        settingsGear.className = "gear-rotate";
    }
}, false);
/*id("desktopToggle").addEventListener("click", function(){
  if(this.checked === true){
    document.body.setAttribute("style","width: 1000px");
  }
  else{
    try{}
    catch(e){
      document.body.removeAttribute("Style");
    }
  }
},false);*/

//select text

var selectText = function(drop) {
    var range;
  try{
    if (document.body.createTextRange) {
        range = document.body.createTextRange();
        range.moveToElementText(drop);
        range.select();
    } else if (window.getSelection) {
        var selection = window.getSelection();
        range = document.createRange();
        range.selectNodeContents(drop);
        selection.removeAllRanges();
        selection.addRange(range);
    }
  }
  catch(e){
    
  }
};

//encoding data

function drawColor() {
    ectx.clearRect(0, 0, ec.width, ec.height);
    var htmlDec;
    for (var currentChar = 0; currentChar < inputString.length; currentChar++) {
        if (inputString.charCodeAt(currentChar) > 255) {
            htmlDec = "&#" + inputString.charCodeAt(currentChar) + ";";
            inputString = inputString.substr(0, currentChar) + htmlDec + inputString.substr(currentChar + 1);
        }
        if (inputString.charCodeAt(currentChar) === 39) {
            htmlDec = "&#39;";
            inputString = inputString.substr(0, currentChar) + htmlDec + inputString.substr(currentChar + 1);
        }
    }
    inputString = inputString.replace(/\r?\n/g, ' ');
    //console.log(inputString.length);
    //console.log(inputString);

    var pixels = Math.ceil((inputString.length + 1) / 3);
    var final = false;
    var squareBool;

    try {
        if (!localStorage.getItem("shape")) {
            for (var squareLength = 0; final !== true; squareLength++) {
                squareBool = Math.pow(squareLength, 2) >= pixels;
                //console.log(squareBool);
                if (squareBool === true) {
                    ec.height = squareLength;
                    ec.width = squareLength;
                    final = true;
                    //console.log(ec.height + ": SHOULD ONLY SHOW UP ONCE");
                }
            }
        } else {
            if (localStorage.getItem("shape") === "square") {
                for (var squareLength = 0; final !== true; squareLength++) {
                    squareBool = Math.pow(squareLength, 2) >= pixels;
                    //console.log(squareBool);
                    if (squareBool === true) {
                        ec.height = squareLength;
                        ec.width = squareLength;
                        final = true;
                        //console.log(ec.height + ": SHOULD ONLY SHOW UP ONCE");
                    }
                }
            }
            if (localStorage.getItem("shape") === "height") {
                if (!localStorage.getItem("length")) {
                    ec.height = 400;
                    ec.width = Math.ceil(pixels / 400);
                } else {
                    if (localStorage.getItem("length").match(/[\D]/g)) {
                        ec.height = 400;
                        ec.width = Math.ceil(pixels / 400);
                    } else {
                        ec.height = localStorage.getItem("length");
                        ec.width = Math.ceil(pixels / localStorage.getItem("length"));
                    }
                }
            }
            if (localStorage.getItem("shape") === "width") {
                if (!localStorage.getItem("length")) {
                    ec.height = Math.ceil(pixels / 400);
                    ec.width = 400;
                } else {
                    if (localStorage.getItem("length").match(/[\D]/g)) {
                        ec.height = Math.ceil(pixels / 400);
                        ec.width = 400;
                    } else {
                        ec.height = Math.ceil(pixels / localStorage.getItem("length"));
                        ec.width = localStorage.getItem("length");
                    }
                }
            }
        }
    } catch (e) {
        for (var squareLength = 0; final !== true; squareLength++) {
            squareBool = Math.pow(squareLength, 2) >= pixels;
            //console.log(squareBool);
            if (squareBool === true) {
                ec.height = squareLength;
                ec.width = squareLength;
                final = true;
                //console.log(ec.height + ": SHOULD ONLY SHOW UP ONCE");
            }
        }
    }


    //canvas.width = document.getElementById("width").value;
    //canvas.height = ((Math.floor((input.length / 3) / canvas.width)) + 1);
    var colorNum = 0;
    var finishedColor = false;
    for (var vertColor = 0; vertColor < ec.height; vertColor++) {
        if (finishedColor === true) {
            break;
        }
        for (var horzColor = 0; horzColor < ec.width; horzColor++) {
            if (finishedColor === true) {
                break;
            }
            var pixelColor = [0, 0, 0];
            for (var rgb = 0; rgb < 3; rgb++) {
                if (isNaN(inputString.charCodeAt(rgb + (3 * colorNum))) === false) {
                    pixelColor[rgb] = inputString.charCodeAt(rgb + (3 * colorNum));
                } else {
                    pixelColor[rgb] = 0;
                    finishedColor = true;
                }
            }
            ectx.fillStyle = "rgb(" + pixelColor[0] + "," + pixelColor[1] + "," + pixelColor[2] + ")";
            ectx.fillRect(horzColor, vertColor, 1, 1);
            colorNum++;
        }
    }
    colorNum = 0;
    //
    window.scroll(0, id("outputSection").offsetTop);
    id("imgurContainer").setAttribute("class", "imgur-container hidden");
    var encodedImage = new Image();
    encodedImage.addEventListener("load", function() {
        id("introBlock").setAttribute("class", "outputBlock hidden");
        id("encodeBlock").setAttribute("class", "outputBlock");
        id("decodeBlock").setAttribute("class", "outputBlock hidden");
        id("encodedImgContainer").innerHTML = '<img src="' + encodedImage.src + '" id="encodedImage"/>';
        id("encodedImgHeight").innerHTML = encodedImage.height;
        id("encodedImgWidth").innerHTML = encodedImage.width;
        //console.log(encodedImage.src);
    }, false);
    encodedImage.src = ec.toDataURL('image/png');
    //console.log(encodedImage);
}

id("encodefileInput").addEventListener("change", function() {
    var files = this.files[0];
    var reader = new FileReader();
    reader.onload = function(event) {
        //console.log(event.target.result);
        inputString = event.target.result;
        //drawColor();
      if(files.size > 1048575){
        showError("File is larger than 1MB. Encoding it may crash your browser. Click the arrow to continue.");
      }
      else{
        drawColor();
      }
    };
    reader.readAsDataURL(files);
}, false);

id("encodeFile").addEventListener("click",function(){
  drawColor();
},false);

id("encodeURL").addEventListener("click", function() {
    //console.log("hi");
    encodingImage = new Image();
    encodingImage.addEventListener("load", function() {
      ectx.clearRect(0, 0, ec.width, ec.height);
      ec.height = this.height;
      ec.width = this.width;
      ectx.drawImage(this,0,0);
      inputString = ec.toDataURL('image/png');
      drawColor();
    }, false);
    encodingImage.addEventListener("error", function() {
      showError("We couldn't access this image.");
    }, false);
    encodingImage.crossOrigin = "Anonymous";
    if (id("encodeURLInput").value.indexOf("://") != -1){
    encodingImage.src = id("encodeURLInput").value;
    }
    else {
    encodingImage.src = "http://" + id("encodeURLInput").value;
    }
}, false);

id("encodeText").addEventListener("click", function() {
    //console.log(btoa(id("encodeTextInput").value));
    inputString = "data:text/plain;base64," + btoa(id("encodeTextInput").value);
    drawColor();
}, false);


id("encodeDL").addEventListener("click", function() {
    this.href = encodedImage.src;
}, false);

// decoding data

var getDataFromCanvas = function() {
    decodeString = "";
    var outputRow = [];
    //var img = new Image();
    //img.src = canvas.toDataURL('image/png', 1);
    var blockSize = 128;
    var height = Math.ceil(decodingImage.height / blockSize);
    var width = Math.ceil(decodingImage.width / blockSize);
    var finished = false;
    for (var imgRow = 0; imgRow < height; imgRow++) {
        for (var imgColumn = 0; imgColumn < width; imgColumn++) {
            dctx.clearRect(0, 0, decodeCanvas.width, decodeCanvas.height);
            if (decodingImage.width - (imgColumn * blockSize) <= blockSize) {
                decodeCanvas.width = decodingImage.width - (imgColumn * blockSize);
            } else {
                decodeCanvas.width = blockSize;
            }
            if (decodingImage.height - (imgRow * blockSize) <= blockSize) {
                decodeCanvas.height = decodingImage.height - (imgRow * blockSize);
            } else {
                decodeCanvas.height = blockSize;
            }
            dctx.drawImage(decodingImage, -(imgColumn * blockSize), -(imgRow * blockSize));
            //test.innerHTML += "<img src='"+decodeCanvas.toDataURL("image/png", 1)+"'/>";
            console.log("row:" + imgRow + ",column:" + imgColumn);

            var canvasImage = dctx.getImageData(0, 0, decodeCanvas.width, decodeCanvas.height);
            var canvasData = canvasImage.data;
            
            if(imgRow === 0 && imgColumn === 0){
              if(canvasData[0] === 100 || canvasData >= 248 && canvasData <= 251){
              console.log("yes");
              }
              else{
                showError("Not a valid image.");
                finished = true;
              }
            }
          
            //console.log(canvasData);
            for (var canvasRow = 0; canvasRow < decodeCanvas.height; canvasRow++) {
                var currentRow = "";
                for (var canvasColumn = 0; canvasColumn < decodeCanvas.width; canvasColumn++) {
                    for (var rgb = 0; rgb < 3; rgb++) {
                        if (canvasData[((canvasRow * (decodeCanvas.width * 4)) + (canvasColumn * 4)) + rgb] !== 0) {
                            currentRow += String.fromCharCode(canvasData[((canvasRow * (decodeCanvas.width * 4)) + (canvasColumn * 4)) + rgb]);
                        } else {
                            //finished = true;
                            //break;
                        }
                    }
                    if (finished === true) {
                        break;
                    }
                }
                if (typeof outputRow[canvasRow + (imgRow * blockSize)] === "undefined") {
                    outputRow[canvasRow + (imgRow * blockSize)] = currentRow;
                } else {
                    outputRow[canvasRow + (imgRow * blockSize)] += currentRow;
                    //console.log(outputRow[canvasRow + (imgRow * blockSize)]);
                }
            }
        }
    }

    for (var i = 0; i < outputRow.length; i++) {
        decodeString += outputRow[i];
    }
    window.scroll(0, id("outputSection").offsetTop);
    id("introBlock").setAttribute("class", "outputBlock hidden");
    id("encodeBlock").setAttribute("class", "outputBlock hidden");
    id("decodeBlock").setAttribute("class", "outputBlock");
    id("iframeContainer").setAttribute("class", "iframe-container hidden");
    if (decodeString.indexOf("data:image") != -1) {
        console.log("image");
        id("decodedImgContainer").innerHTML = "";
        var decodedImage = new Image();
        decodedImage.addEventListener("load", function() {
            id("decodedImgContainer").setAttribute("class", "img-container");
            id("decodedImgContainer").innerHTML = '<img src="' + decodedImage.src + '" id="decodedImage"/>';
            id("decodedInfo").setAttribute("class", "group");
            id("decodedImgHeight").innerHTML = decodedImage.height;
            id("decodedImgWidth").innerHTML = decodedImage.width;
            id("decodedFileType").innerHTML = decodedImage.src.match(/(?=image)(.*?)(?=;|,)/)[0];
        }, false);
        decodedImage.src = decodeString;
    } else if (decodeString.indexOf("data:text/html") != -1) {
        id("decodedImgContainer").setAttribute("class", "img-container hidden");
        id("decodedInfo").setAttribute("class", "group hidden");
        id("iframeContainer").setAttribute("class", "iframe-container");
        id("iframeContainer").innerHTML = '<iframe id="iframe" src="' + decodeString + '" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%;"></iframe>';
        id("decodedFileType").innerHTML = decodeString.match(/data:(.*?)(?=;|,)/)[1];
      console.log(id("decodedFileType").innerHTML);
      //change to affect any file type
    } else if (decodeString.indexOf("data:text/plain") != -1) {
        id("decodedImgContainer").setAttribute("class", "img-container hidden");
        id("decodedInfo").setAttribute("class", "group hidden");
        id("iframeContainer").setAttribute("class", "iframe-container");
      id("iframeContainer").innerHTML = '<iframe id="iframe" src="' + decodeString + '" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%;"></iframe>';
        id("decodedFileType").innerHTML = decodeString.match(/data:(.*?)(?=;|,)/)[1];
    } else {
        id("decodedImgContainer").setAttribute("class", "img-container hidden");
        id("decodedInfo").setAttribute("class", "group hidden");
        id("iframeContainer").setAttribute("class", "iframe-container hidden");
        if(decodeString.match(/data:(.*?)(?=;|,)/)[1] === ""){
          id("decodedFileType").innerHTML = "unknown";
        }
        else{
          id("decodedFileType").innerHTML = decodeString.match(/data:(.*?)(?=;|,)/)[1];
        }
    }
    try {
        id("decodedDL").href = "";
    } catch (e) {}
};

id("decodeFileInput").addEventListener("change", function() {
    decodingImage = new Image();
    var f = id("decodeFileInput").files[0];
    var url = window.URL || window.webkitURL;
    var src = url.createObjectURL(f);
    if(f.type != "image/png"){
      showError("File is not a .png image.");
    }
    decodingImage.src = src;
    decodingImage.onload = function() {
        if(f.type != "image/png"){
          showError("File is not a .png image.");
        }
        else {
        getDataFromCanvas();
        url.revokeObjectURL(src);
        }
    };
}, false);

id("decodeURL").addEventListener("click", function() {
    //console.log("hi");
    decodingImage = new Image();
    decodingImage.addEventListener("load", function() {
        getDataFromCanvas();
    }, false);
    decodingImage.addEventListener("error", function() {
      showError("We couldn't access this image.");
    }, false);
    decodingImage.crossOrigin = "Anonymous";
    if (id("decodeURLInput").value.indexOf("://") != -1){
      decodingImage.src = id("decodeURLInput").value;
    }
    else{
      decodingImage.src = "http://" + id("decodeURLInput").value;
    }
}, false);


id("decodeDL").addEventListener("click", function() {
    this.href = decodeString;
}, false);

id("error-close").addEventListener("click",function(){
  id("errorContainer").setAttribute("class", "error-container hidden");
},false);

var showError = function(info){
  id("error-text").innerHTML = info;
  id("errorContainer").setAttribute("class", "error-container");
};

function share(){
var clientId = "5b8e80704fd9601";
try {
  var img = ec.toDataURL('image/png', 1).split(',')[1];
}
catch(e) {
  var img = ec.toDataURL().split(',')[1];
}
  
var xhr;
if (window.XMLHttpRequest) {
  xhr = new XMLHttpRequest();
}
else {
  //error
}

xhr.onreadystatechange = function() {
  if (xhr.readyState == 4 && xhr.status != 200) {
    //error
    id("loading").setAttribute("class", "hidden");
    var data = JSON.parse(xhr.response);
    console.log(xhr.response);
    showError("Imgur upload failed. (" + data.status + ")");
  }
  if (xhr.readyState == 4 && xhr.status == 200) {
    id("loading").setAttribute("class", "hidden");
    var data = JSON.parse(xhr.response);
    console.log(xhr.response);
    id("imgurContainer").setAttribute("class", "imgur-container");
    id("imgurURL").innerHTML = data.data.link;
    id("directDecodeURL").innerHTML = "http://d2co.github.io/f?i=" + data.data.id;
  }
};

if (location.protocol === 'https:') {
    xhr.open("POST", "https://api.imgur.com/3/upload", true);
}
if (location.protocol === 'http:') {
    xhr.open("POST", "http://api.imgur.com/3/upload", true);
}
xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
xhr.setRequestHeader("Authorization", "Client-ID " + clientId);
xhr.send(JSON.stringify({image: img}));
}

id("encodeImgur").addEventListener("click",function(){
  id("loading").removeAttribute("class");
  share();
},false);

id("directDecodeURL").addEventListener("click",function(){
  selectText(this);
},false);
id("imgurURL").addEventListener("click",function(){
  selectText(this);
},false);
</script>
</body>
</html>
